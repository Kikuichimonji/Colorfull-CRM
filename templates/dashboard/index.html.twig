{% extends 'layouts/loggedin.html.twig' %}

{% block title %}Dashboard{% endblock %}
{% block nav %}
    {{parent()}}
{% endblock %}
{% block content %}
<div class="content">
{% if is_granted('ROLE_ADMIN') %}
    HELLO ADMIN
{% endif %}
    <h1>DASHBOARD</h1>
    {% if error %}
        <div>{{ error }}</div>
    {% endif %}
    <div id="fullBlock">
        <div id="blockInfo">
            <div id="blockEvent">
                <h2>évenements</h2>
                <div class="dashBlock">
                    {% set todayDate = "now"|date("d") %}
                    {% set today = 0 %}
                    {% set tommorow = 0 %}
                    {% set later = 0 %}
                    {% for event in planning.events|sort((a, b) => a.dateEnd <=> b.dateEnd) %}
                        {% set eventDay = event.dateEnd|date("d") %}
                        {% if eventDay == todayDate and today == 0 %}
                            <h3>Aujourd'hui :</h3>
                            {% set today = 1 %}
                        {% endif %}
                        {% if eventDay == todayDate + 1 and tommorow == 0 %}
                            <h3>Demain :</h3>
                            {% set tommorow = 1 %}
                        {% endif %}
                        {% if eventDay > todayDate + 1 and later == 0 %}
                            <h3>Plus tard :</h3>
                            {% set later = 1 %}
                        {% endif %}
                        <p><span style='color:{{ event.eventType.color }}'>{{ event.eventType.label }}</span> {{ event.label }} 
                            {% if later == 0 %} 
                                {{ event.dateStart|date("H:i") }}
                                {{ event.dateEnd|date("H:i") }}
                            {% else %}
                                {{ event.dateStart|date("d/m H:i") }}
                                {{ event.dateEnd|date("d/m H:i") }}
                            {% endif %} 
                        <p>
                    {% endfor %}
                </div>
            </div>
            <div id="blockContact">
                <h2>contacts</h2>
                <div class="dashBlockHeader">
                    <div class="dashBlockHeaderChild">
                        {% for contactType in contactTypes %}
                            <div><span class='contactColorBlock' style="background-color:{{contactType.color}}"></span><p>{{contactType.label}}</p></div>
                        {% endfor %}
                    </div>
                    <div class="dashBlock">
                        {% for contact in contacts %}
                            <div class="contactLine">
                                <div class='contactColorBlock'>
                                    {% set colorCount = 1 %}
                                    {% for type in contact.contactType %}
                                        <div class="color{{ colorCount }}" style="background-color:{{type.color}}"></div>
                                        {% set colorCount = colorCount + 1 %}
                                    {% endfor %}
                                </div>
                                <p>{{ contact.name }}</p> <p>{{contact.phone1 ?? contact.phone2 ?? "/"}}</p> <p>{{contact.email ?? "/"}}</p> <p>{{contact.isCompany ? "Société" : "Particulier"}}</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div id="blockPlanning">
            <h2>plannings</h2>
            <div class="dashBlock">
                {% for team in user.ownedteams %}
                <div class='teamBlock'>
                    <h3>{{ team.label }}</h3>
                    {% for user in team.users %}
                        <div style="border-color:{{ team.color }}"> <p>{{ user.firstname}}</p> <p>{{ user.lastName}}</p></div>
                    {% endfor %}
                </div>
                {% endfor %}
                <div class='invitedBlock'>
                <h3>Invité</h3>
                    {% for planning in user.plannings %}
                        <div> <p>{{ planning.planningowner.firstname}}</p> <p>{{ planning.planningowner.lastName}}</p></div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block style %}
    {{parent()}}
    <link href="{{asset('assets/css/dashboard.css')}}" rel="stylesheet" type="text/css">
{% endblock %}

{% block script_body %}
    {{parent()}}
{% endblock %}
